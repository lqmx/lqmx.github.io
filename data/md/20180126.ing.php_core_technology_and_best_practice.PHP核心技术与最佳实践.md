# PHP Core Technology and Best Practice

###### 2018.01.26

PHP 核心技术与最佳实践

## 第四章 PHP网络技术及应用

### 4.1 HTTP协议详解

HTTP是一个基于应用层的通信规范

#### 4.1.1 HTTP协议与SPDY协议

HTTP是一个应用层协议,由请求和响应构成,是一个标准的客户端服务器模型。
HTTP协议是一个无状态的协议,同一个客户端的两个请求没有对应关系。

SPDY协议是Google推出的协议,优化了浏览器和服务器之间的通信

+ 支持流复用
+ 具备优先级的请求
+ 主动发起请求
+ 强制SSL安全传输

SPDY协议的应用需要客户端和服务器同时支持

#### 4.1.2 HTTP协议如何工作

一次HTTP操作称为一个事务

1. 客户端与服务器建立连接
2. 客户端发送一个请求给服务器(URL+协议版本号+MIME信息)
3. 服务器接到请求,给予响应(状态行+MIME信息)
4. 客户端与服务器断开连接

协议中的一些概念

##### 1. 请求

HTTP请求由三个部分组成:`请求行`,`消息报头`,`请求正文`

请求行: Method(请求方法) Request-URL(统一资源标识符) HTTP-Version(HTTP协议版本) CRLF(回车和换行)

请求方法如下:

+ GET 请求获取Request URL所标识的资源
+ POST 在Request URL所标识的资源后面附加新的数据
+ HEAD 请求获取由Request URL所标识的资源的响应消息报头
+ PUT 请求服务器存储一个资源,并用Request URL作为其标识
+ DELETE 请求服务器删除Request URL所标识的资源
+ TRACE 请求服务器回送收到的请求消息,主要用于测试或诊断
+ CONNECT 保留以备将来使用
+ OPTIONS 请求查询服务器的性能,或者查询与资源相关的选项和需求

##### 2. 响应

HTTP响应也由三个部分组成:`状态行`,`消息报头`,`响应正文`

状态行: HTTP-Version(HTTP协议版本) Status-Code(服务器返回的响应状态代码) Reason-Phrase(状态代码的文本描述) CRLF(回车和换行)

状态代码:

+ 1xx: 指示消息-请求已接收,继续处理
+ 2xx: 成功-请求已被成功接收、理解、接受
+ 3xx: 重定向-要完成请求必须进一步的操作
+ 4xx: 客户端错误-请求有语法错误或请求无法实现
+ 5xx: 服务端错误-服务端未能实现合法的请求

常见的状态码:

+ 200 OK 客户端请求成功
+ 400 Bad Request 客户端请求有语法错误,不能被服务端理解
+ 401 Unauthorized 请求未经授权
+ 403 Forbidden 服务器收到请求,但是拒绝提供服务
+ 404 Not Found 请求资源不存在
+ 500 Internal Server Error 服务器发生不可预期的错误
+ 503 Server Unavailable 服务器当前不能处理客户端的请求,一段时间后可能恢复正常

##### 3. 报头

HTTP消息报头包括`普通报头`,`请求报头`,`响应报头`,`实体报头`
报头的格式: 名字+: +空格+值
消息报头域的名字不区分英文大小写

+ 普通报头中有少数报头域用户所有的请求和响应消息,但不用于被传输的实体,只用于传输的消息
(如缓存控制、连接控制等)
+ 请求报头允许客户端向服务器传递请求的附加消息以及客户端自身的信息(如UA头、Accept等)
+ 响应报头允许服务器传递不能放在状态行中的附加响应信息,以及关于服务器的消息和对Request
URL所标志的资源进行下一步的访问的消息(如Location)
+ 实体报头定义了关于实体正文和请求所标志的资源的元信息,例如有无实体正文

比较重要的报头:

+ Host 头域指定请求资源的Internet主机和端口号
+ User Agent 包含发出请求的用户信息(不仅使用浏览器才存在,只要使用了基于HTTP协议的客户端
软件都会发送这个请求)
+ Cookie 
    - 客户端向服务端发送的,使用Cookie报头(value里可以有多个Cookie值,不需要显式指定domain等)
    - 服务端发送给浏览器的,报头为Set Cookie(只能有一个Cookie的value,需要指定domain、path等)
+ Cache Control 指定请求和响应遵循的缓存机制
+ Referer 头域允许客户端指定请求URI的源资源地址,这个可以允许服务器生成回退链表,用来
登录、优化缓存等。Referer通常是流量统计系统中用来记录来访者地址的参数
+ Content Length 内容长度
+ Content Range 响应的资源范围,可以实现断点续传
+ Accept Encoding 指定所能接受的编码方式
+ 自定义报头

###### 2018.01.26