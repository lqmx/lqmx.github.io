<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="update_time" content="1519913426">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>MySQL技术内幕 第一章 MySQL体系结构和存储引擎</title>
    <link rel="shortcut icon" type="images/x-icon" href="/favicon.png?v1519913426">
    <link rel="stylesheet" href="../../css/reset.css?v1519913426">
    <link rel="stylesheet" href="../../css/md.css?v1519913426">
    <link rel="stylesheet" href="../../css/module.css?v1519913426">
    <link rel="stylesheet" href="../../css/c.css?v1519913426">
    <link rel="stylesheet" href="../../dep/highlight/style/monokai_sublime.css?v1519913426">
    <script src="../../dep/require.js?1519913426"></script>
</head>
<body>
    <div class="md"><h1>第一章 MySQL体系结构和存储引擎</h1>
<h6>2018.03.01</h6>
<h2>1.1 定义数据库和实例</h2>
<p><code class="inline-code">数据库</code>：物理操作系统文件或其他形式文件类型的集合</p>
<p><code class="inline-code">实例</code>：MySQL数据库由后台线程以及一个共享内存区组成</p>
<p>MySQL数据库实例在系统上的表现就是一个进程。</p>
<pre><code class="language-bash" data-comment=""># 启动MySQL实例
./mysqlid_safe &amp;
ps -ef | grep mysqld</code></pre>
<p>配置文件</p>
<pre><code class="language-bash" data-comment="">mysql --help | grep my.cnf</code></pre>
<pre><code class="language-mysql" data-comment="">show variables like 'datadir'\G;
system ls -lh /usr/local/mysql/data;</code></pre>
<h2>1.2 MySQL体系结构</h2>
<p>从概念来说</p>
<p>数据库是文件的集合，是依照某种数据模型组织起来并存放于二级存储器中的数据集合</p>
<p>数据库实例是程序，是位于用户与操作系统之间的一层数据管理软件，用户对数据库数据的任何操作，包括数据库定义、
数据查询、数据维护、数据库运行控制等都是在数据库实例下进行的，应用程序只有通过数据库实例才能和数据库打交道。</p>
<p>MySQL由以下几部分组成</p>
<ul>
<li>连接池组件</li>
<li>管理服务和工具组件</li>
<li>SQL接口组件</li>
<li>查询分析器组件</li>
<li>优化器组件</li>
<li>缓存组件</li>
<li>插件式存储引擎</li>
<li>物理文件</li>
</ul>
<p>存储引擎是基于表的，而不是数据库</p>
<h2>1.3 MySQL存储引擎</h2>
<h3>1.3.1 InnoDB存储引擎</h3>
<p>InnoDB支持事务，特点为行锁设计、支持外键，支持非锁定读，从5.5.8版本起为默认存储引擎。</p>
<p>InnoDB吧数据放在一个逻辑表空间中。</p>
<p>InnoDB使用多版本并发控制获得高并发，有四种隔离级别，默认为REPEATABLE级别，通过next-key locking避免幻读，提供了插入缓冲、
二次写、自适应哈希索引、预读等高性能和高可用的功能。</p>
<p>对表中的数据采用聚集的方式，每张表的存储都是按主键的顺序存放的。</p>
<h3>1.3.2 MyISAM存储引擎</h3>
<p>MyISAM不支持事务、表锁设计，支持全文索引。MyISAM的缓冲池只缓冲索引文件，而不缓冲数据文件。</p>
<p>MyISAM表由MYD和MYI组成，MYD用来存放数据文件，MYI用来存放索引文件。</p>
<h3>1.3.3 NDB存储引擎</h3>
<p>NDB是一个集群存储引擎，数据全部放在内存中</p>
<p>NDB的连接（JOIN）操作是MySQL数据库层完成的，而不是在存储引擎层，需要网络开销，查询速度慢。</p>
<h3>1.3.4 Memory存储引擎</h3>
<p>Memory将数据存放于内存中，使用哈希索引，只支持表锁，并发性能较差，不支持TEXT和BLOB列类型。</p>
<h3>1.3.5 Archive存储引擎</h3>
<p>Archive只支持INSERT和SELECT操作，使用zlib算法压缩后存储，使用行锁，当并不是事务安全的。</p>
<h3>1.3.6 Federated存储引擎</h3>
<p>Federated并不存放数据，它指向一台远程MySQL数据库服务器上的表。</p>
<h3>1.3.7 Maria存储引擎</h3>
<p>Maria支持缓存数据和索引文件，行锁设计，提供MVCC功能，支持事务和非事务的安全选项，已经更好的BLOB字符类型处理。</p>
<h3>1.3.8 其他存储引擎</h3>
<h2>1.4 各存储引擎之间的比较</h2>
<table>
<thead>
<tr>
<th>faeture</th>
<th>MyISAM</th>
<th>DBD</th>
<th>Memory</th>
<th>InnoDB</th>
<th>Archive</th>
<th>NDB</th>
</tr>
</thead>
<tbody>
<tr>
<td>Storage Limits</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>64TB</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Transactions(commit,rollback,etc)</td>
<td></td>
<td>+</td>
<td></td>
<td>+</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Locking granularity</td>
<td>Table</td>
<td>Page</td>
<td>Table</td>
<td>Row</td>
<td>Row</td>
<td>Row</td>
</tr>
<tr>
<td>MVCC/Snapshot Read</td>
<td></td>
<td></td>
<td></td>
<td>+</td>
<td>+</td>
<td>+</td>
</tr>
<tr>
<td>Geospatial support</td>
<td>+</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>+</td>
</tr>
<tr>
<td>B-tree indexes</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td></td>
<td>+</td>
</tr>
<tr>
<td>Hash indexes</td>
<td></td>
<td></td>
<td>+</td>
<td>+</td>
<td></td>
<td>+</td>
</tr>
<tr>
<td>Full text search index</td>
<td>+</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Clustered index</td>
<td></td>
<td></td>
<td></td>
<td>+</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Data Caches</td>
<td></td>
<td></td>
<td>+</td>
<td>+</td>
<td></td>
<td>+</td>
</tr>
<tr>
<td>Index Caches</td>
<td>+</td>
<td></td>
<td>+</td>
<td>+</td>
<td></td>
<td>+</td>
</tr>
<tr>
<td>Compressed data</td>
<td>+</td>
<td></td>
<td></td>
<td></td>
<td>+</td>
<td></td>
</tr>
<tr>
<td>Encrypted data(via function)</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
</tr>
<tr>
<td>Storage cost(space used)</td>
<td>Low</td>
<td>Low</td>
<td>N/A</td>
<td>High</td>
<td>Very Low</td>
<td>Low</td>
</tr>
<tr>
<td>Memory cost</td>
<td>Low</td>
<td>Low</td>
<td>Medium</td>
<td>High</td>
<td>Low</td>
<td>High</td>
</tr>
<tr>
<td>Bulk Insert Speed</td>
<td>High</td>
<td>High</td>
<td>High</td>
<td>Low</td>
<td>Very High</td>
<td>High</td>
</tr>
<tr>
<td>Cluster database support</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>+</td>
</tr>
<tr>
<td>Replication support</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
</tr>
<tr>
<td>Foreign key support</td>
<td></td>
<td></td>
<td></td>
<td>+</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Backup/Point-in-time recovery</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
</tr>
<tr>
<td>Query cache support</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
</tr>
<tr>
<td>Update Statistics for Data Dictionary</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
</tr>
</tbody>
</table>
<pre><code class="language-mysql" data-comment=""># 查看支持的引擎
show engines\G;
# 使用和修改引擎配置
create table mytest Engine=MyISAM;
alter table mytest Engine=InnoDB;</code></pre>
<h2>1.5 链接MySQL</h2>
<h3>1.5.1 TCP/IP</h3>
<pre><code class="language-bash" data-comment="">mysql -h192.168.0.1 -udavid -p</code></pre>
<p>权限表</p>
<pre><code class="language-mysql" data-comment="">use mysql;
select host, user, password from user;</code></pre>
<h3>1.5.2 命名管道和共享内存</h3>
<p>配置文件配置,启用选项</p>
<pre><code class="language-ini" data-comment="">--enable-name-pipe
--shard-memory</code></pre>
<p>客户端启用选项</p>
<pre><code class="language-ini" data-comment="">--protocol=memory</code></pre>
<h3>1.5.3 UNIX域套接字</h3>
<pre><code class="language-mysql" data-comment="">show variables like 'socket';</code></pre>
<pre><code class="language-bash" data-comment="">mysql -udavid -S /tmp/mysql.sock</code></pre>
<h2>1.6 小结</h2>
<h6>2018.03.01</h6></div>
<script >
    requirejs(['../../js/conf/r'], function(rc) {
        requirejs(['../js/html']);
    });
</script>
</body>
</html>